"use strict";!function(){function e(){function e(e,t){if(!W.hasOwnProperty(e))return t(null);var n=W[e];n.sync(function(i){if(i)throw i;return delete W[e],W[e]=n,t(W[e])})}function t(e,t){var n={groupingItemURI:e,xooMLDriver:F,itemDriver:I,syncDriver:{utilityURI:"MirrorSyncUtility"},readIfExists:!0};require(["ItemMirror"],function(e){M.authenticate(function(i){if(i)throw i;new e(n,function(e,n){e&&t(e,n),t(e,n)})})})}function n(e,t,n){e.createItemMirrorForAssociatedGroupingItem(t,function(e,t){if(e)throw e;return n(t)})}function i(e){M.authenticate(function(t,n){if(t)throw t;n.getUserInfo(null,function(t,n){var i=n.name,r=n.email;e(i,r)})})}function r(e,t,n,i,o,l){if(t>e.length-1||0==e.length)return l();var u=e[t],d="";n.getAssociationDisplayText(u,function(e,t){if(e)throw console.log("1: "+e),e;d=t});var p="";n.getAssociationNamespaceAttribute("dueDate",u,q,function(e,t){if(e)throw console.log("2: "+e),e;p=t});var f="";n.getAssociationNamespaceAttribute("doORac",u,q,function(e,t){if(e)throw console.log("3: "+e),e;f=t});var h="";n.getAssociationLocalItem(u,function(e,t){if(e)throw console.log("4: "+e),e;h=t});var g="";c(n,e[t],function(c){if(0==c){if(""==h)n.getAssociationAssociatedItem(e[t],function(e,t){if(e)throw e;g=t,""==t||"undefined"==typeof t?E(u,d,p,f,"",""):E(u,d,p,f,g,"url"),T(i)});else{var m=h.split("."),y=m[m.length-1];"url"==y?a(o+h+"/",u,function(e){g=e,E(u,d,p,f,g,"url"),T(i)}):s(o+h+"/",u,function(e){g=e,E(u,d,p,f,g,"file"),T(i)})}r(e,t+=1,n,i,o,l)}else E(u,d,p,f,"","folder"),T(i),r(e,t+=1,n,i,o,l)})}function o(t,i,o,a){null==i||void 0===typeof i||""==i?R.listAssociations(function(e,n){k(),w(i,t),T(o),$("#paper").show(),0==n.length||r(n,0,R,o,a,function(){})}):e(i,function(e){n(e,i,function(e){e.listAssociations(function(n,s){k(),w(i,t),T(o),$("#paper").show(),0==s.length||r(s,0,e,o,a,function(){})})})})}function a(e,t,n){M.authenticate(function(t,i){if(t)throw t;i.readFile(e,null,function(e,t){var i=t.split("\r\n");$(i).each(function(e,t){return""!=t&&-1!=t.search("URL=")?n($.trim(t.replace("URL=",""))):void 0})})})}function s(e,t,n){M.authenticate(function(t,i){if(t)throw t;i.makeUrl(e,null,function(e,t){return n(t.url)})})}function l(e,t,n){if($("#"+e).hasClass("notes"))return n(t);var i=$("#"+e).parent("ol").attr("id");t=$("#"+i).attr("title")+"/"+t,l(i,t,function(e){return n(e)})}function c(e,t,n){e.isAssociatedItemGrouping(t,function(e,t){return e?(console.log(e),n(!1)):n(t)})}function u(e,t,n){e.getAssociationLocalItem(t,function(e,t){if(e)throw e;return n(t)})}function d(e,t,n,i){e.getAssociationNamespaceAttribute(t,n,q,function(e,t){if(e)throw e;i(t)})}function p(e,t,n,i){e.setAssociationNamespaceAttribute(t,n.toString(),i,q,function(e){if(e)throw e})}function f(t,i,r,o,a){e(t,function(e){switch(o){case"association":p(e,i,r,t);break;case"next":n(e,t,function(e){p(e,i,r,a)});case"fragement":R.setFragmentNamespaceAttribute(i,r,q,function(e){if(e)throw e})}})}function h(t,i,r,o,a){e(t,function(e){n(e,t,function(e){e.createAssociation({displayText:i},function(t,n){E(n,i,r,"true","",""),T(a),p(e,"dueDate",r.toString(),n),p(e,"doORac",o.toString(),n)})})})}function g(t,i){e(t,function(e){n(e,t,function(e){e.deleteAssociation(i,function(e){if(e)throw e})})})}function m(e,t,i,r){e.createAssociation({displayText:i,itemName:i,isGroupingItem:!0},function(o,a){return o?r(!1):(x(a,i,i,"rgb(58, 110, 165)",t),p(e,"color","rgb(58, 110, 165)",a),p(e,"createDate",A().toString(),a),k(),w(a,i),T("rgb(58, 110, 165)"),W[a]=e,n(e,a,function(){return r(!0)}),void 0)})}function y(i,r,o,a){null!=o?e(o,function(e){n(e,o,function(e){m(e,o,i,function(e){return a(e)})})}):t(r,function(e,t){return e?a(!1):(m(t,o,i,function(e){return a(e)}),void 0)})}function v(t){e(t,function(e){e.deleteAssociation(t,function(e){if(e)throw e;delete W[t]})})}function b(e){var t="blue";switch(e){case"rgb(255, 204, 102)":t="yellow";break;case"rgb(58, 110, 165)":t="blue";break;case"rgb(194, 71, 71)":t="red";break;case"rgb(51, 153, 102)":t="green";break;default:t="blue"}return t}function x(e,t,n,i,r){var o=b(i),a="notes_panel",s="notes";null!=r?(a=r,s="sublist",$("#"+a).children("li").children(".triangle").removeClass("hidden1"),$("#"+a).append($("<ol></ol>").attr({id:e,title:t}).addClass(s))):$("#"+a).prepend($("<ol></ol>").attr({id:e,title:t}).addClass(s)),$("#"+e).append($("<li></li>").addClass("list").addClass("ui-draggable").css("position","relative").append($("<div></div>").addClass("task_color").addClass(o)).append($("<div></div>").addClass("triangle").addClass("triangle-right").addClass("hidden1")).append($("<div></div>").html(n)))}function w(e,t){$(".click").attr("id",e),$(".click").html(t)}function k(){$(".task").remove()}function C(e){""!=e?$("#"+e).children("ol").remove():$(".notes").remove()}function T(e){(""==e||"undefined"==typeof e||null==e)&&(e="rgb(58, 110, 165)",f($(".click").attr("id"),"color",e,"association",null)),$("article").css("background-color",e),$("li.task").css("background-color",e),$(".line").css("background-color",e);for(var t=N(e),n=0;n<t.length;n++)t[n]=Math.max(0,t[n]-190);"rgb("+t[0]+","+t[1]+","+t[2]+")";for(var i=N(e),n=0;n<i.length;n++)i[n]=Math.max(0,i[n]-10);var r="rgb("+i[0]+","+i[1]+","+i[2]+")";$("li.task").hover(function(){$(this).css("background-color",r)},function(){$(this).css("background-color",e)})}function N(e){var t;return(t=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))?[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]:(t=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))?[2.55*parseFloat(t[1]),2.55*parseFloat(t[2]),2.55*parseFloat(t[3])]:(t=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:(t=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]:void 0}function A(){var e=new Date,t=e.getFullYear(),n=e.getMonth(),i=e.getDate(),r=e.getHours(),o=e.getMinutes();return i+"/"+n+"/"+t+"-"+r+":"+o}function E(e,t,n,i,r,o){var a="";if(a="false"==i?"done":"active",$("#"+a).prepend($("<li></li>").addClass("task").attr({id:e}).append($("<span></span>").addClass("date").html(n)).append($("<span></span>").addClass("task-name").html(t)).append($("<span></span>").addClass("task-action").append($("<button></button>").addClass("task-active-button").attr({type:"button"}).html("Active").addClass(function(){return"false"==i?"":"hidden"})).append($("<button></button>").addClass("task-done-button").attr({type:"button"}).html("Done").addClass(function(){return"false"==i?"hidden":""})).append($("<button></button>").addClass("task-delete-button").attr({type:"button"}).html("Delete")))),""!=o){if($("#"+e+".task").children(".task-name").html(""),"file"==o){var s=t.split("."),l=s[s.length-1],c=["ade","cdr","igs","pdf","ppt","pptx","wri","xls","xlxs","zip","mp3","wav","txt","doc","docx","txt"],u=["jpg","bmp","dib","jpg","jpeg","jpe","jfif","gif","tif","tiff","png","ico"];$.each(c,function(e,t){l==t&&(o="txt")}),$.each(u,function(e,t){l==t&&(o="pic")}),"txt"!=o&&"pic"!=o&&(o="unknown")}$("#"+e+".task").children(".task-name").append($("<a></a>").attr({href:r,target:"_blank"}).addClass("task-link").append($("<div></div>").addClass("icon").addClass(o)).append($("<span><span>").html(t))),"folder"==o&&$("#"+e+".task").children(".task-name").children("a").removeAttr("target").removeAttr("href")}}function D(e,n){t(e,function(e,t){if(e)throw e;return R=t,n(t)})}function S(e,t,i,r,o){return t>e.length-1||0==e.length?o():(c(r,e[t],function(a){W[e[t]]=r,a?u(r,e[t],function(a){var s=a;a.length>15&&(s=a.substring(0,10)+"..."),d(r,"color",e[t],function(l){n(r,e[t],function(n){x(e[t],a,s,l,i),j(n,e[t]),S(e,t+=1,i,r,o)})})}):S(e,t+=1,i,r,o)}),void 0)}function j(e,t){e.listAssociations(function(n,i){if(n)throw n;S(i,0,t,e,function(){})})}function L(e,t){var i=W[e];n(i,e,function(n){j(n,e,function(){return t()})})}function H(){R.sync(function(){R.getFragmentNamespaceAttribute("color",q,function(e,t){if(e)throw e;null==t||"undefined"==typeof t?(t="rgb(58, 110, 165)",R.setFragmentNamespaceAttribute("color",t,q,function(e){if(e)throw e;o(P,"",t,_)})):o(P,"",t,_)})})}var I,F,M,O=new Object,_="/",P="",R="",q="http://noteU";M=new Dropbox.Client({key:"lIIemIURNrA=|JZxk4BbHQ6384pHW77rSHyOb44koORg73AKQQ4kd9w==",sandbox:!0}),M.authDriver(new Dropbox.Drivers.Redirect({rememberUser:!0})),F={driverURI:"DropboxXooMLUtility",dropboxClient:M},I={driverURI:"DropboxItemUtility",dropboxClient:M};var W=new Object;return O.getUserName=i,O.loadFolders=j,O.loadTask=o,O.deleteTask=g,O.createTask=h,O.createChecklist=y,O.deleteChecklist=v,O.setAttributeValue=f,O.uichangecolor=T,O.uiRemoveDir=C,O.colorTranslate=b,O.rootPath=_,O.rootFolder=P,O.getuiPath=l,O.createRootItemMirror=D,O.MapItemMirror=W,O.createItemMirror=n,O.reloadFolders=L,O.loadDefaultTask=H,O}function t(){$("#paper").hide(),i.getUserName(function(e,t){$("#username").html(e),$("#username").attr("title",t),i.uiRemoveDir(""),i.createRootItemMirror(i.rootPath,function(e){i.loadFolders(e,null)})})}function n(){function e(e,n,i,r){0==i?($("#confirm").show(),$("#cancel").show()):($("#confirm").hide(),$("#cancel").hide()),$("#alerttitle").html(e),$("#alertmsg").html(n),1==i?$("#basic-modal-content").modal():$("#basic-modal-content").modal({onShow:function(){var e=this;$("#cancel").click(function(){return e.close(),!1}),$("#confirm").click(function(){return t(r),e.close(),!1})}})}function t(e){$("#paper").hide();var t=$("#"+e).parent().children("ol").length,n=$("#"+e).parent().attr("id");1==t&&"notes_panel"!=n&&($("#"+e).parent().children("li").children(".triangle").removeClass("triangle-down"),$("#"+e).parent().children("li").children(".triangle").addClass("triangle-right"),$("#"+e).parent().children("li").children(".triangle").addClass("hidden1")),$("#"+e).remove(),i.deleteChecklist(e)}var n,r,o,a="rgb(58, 110, 165)",s="blue";$("#datepicker").datepicker({showOn:"button",buttonImage:"image/calendar.png",buttonImageOnly:!0,inline:!0}),$("#up").click(function(){r=$(".click").attr("id"),o=$("#"+r).parent("ol").attr("id"),""==r||null==r||"undefined"==typeof r?e("Notice","You are in the top checklist!",!0,""):null==o||"undefined"==typeof o||""==o?e("Notice","You are in the top checklist!",!0,""):($("#paper").hide(),n=$("#"+o).attr("title"),a=$("#"+o).children("li").children(".task_color").css("background-color"),i.getuiPath(o,n+"/",function(e){$("#"+r).children("li").css("background-color","#47A3DA"),$("#"+o).children("li").css("background-color","rgb(0, 0, 102"),i.loadTask(n,o,a,i.rootPath+e)}))}),$("body").delegate(".task-delete-button","click",function(){var e=$(this).parent("span").prev(".task-name").children("a").children("div").hasClass("folder");if(o=$(".click").attr("id"),r=$(this).parents("li").attr("id"),$(this).parents("li").remove(),1==e){var t=$("#"+r).parent("ol").children("ol").length,n=$("#"+r).parent("ol").attr("id");1==t&&"notes_panel"!=n&&($("#"+r).parent("ol").children("li").children(".triangle").removeClass("triangle-down"),$("#"+r).parent("ol").children("li").children(".triangle").addClass("triangle-right"),$("#"+r).parent("ol").children("li").children(".triangle").addClass("hidden1")),$("#"+r).remove(),i.deleteChecklist(r)}else i.deleteTask(o,r)}),$("body").delegate("#new-task-button","click",function(){""!=$("#new-task-name").val()?(a=$("article").css("background-color"),i.createTask($(".click").attr("id"),$("#new-task-name").val(),$("#datepicker").val(),!0,a),$("#new-task-name").val(""),$("#datepicker").val("")):e("Notice","Please type in your task!",!0,"")}),$("body").delegate("#newnote","click",function(){$("#dialog-modal-content").modal({onShow:function(){var t=this;$("#folder-name").val(""),$("#dialog-cancel").click(function(){return t.close(),!1}),$("#dialog-create").click(function(){r=null,$("li.list").each(function(){var e=$(this).css("background-color");"rgb(0, 0, 102)"==e&&(r=$(this).parent("ol").attr("id"))});var n=i.rootPath,o=$("#folder-name").val();return t.close(),null==o||""==o?e("Notice","Please type in your checklist!",!0,""):i.createChecklist(o,n,r,function(t){0!=t?($("#paper").show(),null!=r&&($("#"+r).children("li").children(".triangle").removeClass("triangle-right"),$("#"+r).children("li").children(".triangle").addClass("triangle-down"),$("#"+r).children("ol").slideDown("slow"),$("#"+r).children("li").css("background-color","#47A3DA")),r=$("#"+r).children("ol").last().attr("id"),$("#"+r).children("li").css("background-color","rgb(0, 0, 102")):e("Notice","This checklist is existed, please try again!",!0,"")}),!1})}})}),$(".tools").delegate("#delete","click",function(){r=$(".click").attr("id"),e("Notice","remove?",!1,r)}),$("body").delegate(".task-done-button","click",function(){o=$(".click").attr("id"),r=$(this).closest("li").attr("id"),$(this).toggleClass("hidden");var e=$(this).prev();$(e).toggleClass("hidden");var t=$(this).parents("li");$("#done").prepend(t),i.setAttributeValue(o,"doORac","false","next",r)}),$("body").delegate(".task-active-button","click",function(){o=$(".click").attr("id"),r=$(this).closest("li").attr("id"),$(this).toggleClass("hidden");var e=$(this).next();$(e).toggleClass("hidden");var t=$(this).parents("li");$("#active").prepend(t),i.setAttributeValue(o,"doORac","true","next",r)}),$("body").delegate(".list","click",function(){$("#paper").hide(),$(".list").css("background-color","#47A3DA"),$(this).css("background-color","#006"),r=$(this).parent().attr("id"),n=$(this).parent().attr("title"),a=$(this).children(".task_color").css("background-color"),i.getuiPath(r,n+"/",function(e){i.loadTask(n,r,a,i.rootPath+e)})}),$("#trashcan").click(function(){r=null,$("li.list").each(function(){var e=$(this).css("background-color");"rgb(0, 0, 102)"==e&&(r=$(this).parent("ol").attr("id"))}),null!=r?e("Notice","remove?",!1,r):e("Notice","Please select one checklist or drag to the trash can!",!0,"")}),$("#taskpanel").delegate(".list","mousedown",function(){$(this).draggable({revert:!0})}),$("#trashcan").droppable({hoverClass:"pink",drop:function(t,n){var i=$(this);i.toggleClass("pink"),n.draggable.addClass("hidden",function(){r=n.draggable.parent("ol").attr("id"),e("Notice","remove?",!1,r),i.removeClass("pink")})}}),$("body").delegate(".click","click",function(){$(".click").editable(function(e,t){return console.log(this),console.log(e),console.log(t),e},{indicator:"<img src='img/indicator.gif'>",tooltip:"Click to edit...",style:"inherit"})}),$("body").delegate("a","click",function(){$(this).children("div").hasClass("folder")&&($("#paper").hide(),o=$(".click").attr("id"),r=$(this).parent("span").parent("li").attr("id"),n=$(this).children("span").html(),a=$("#"+r).children("li").children(".task_color").css("background-color"),i.getuiPath(r,n+"/",function(e){$("#"+r).children("li").css("background-color","rgb(0, 0, 102)"),$("#"+o).children("li").css("background-color","#47A3DA"),i.loadTask(n,r,a,i.rootPath+e)}))}),$(".tools").delegate("a","click",function(){if(a=$(this).css("background-color"),s=i.colorTranslate(a),r=$(".click").attr("id"),i.uichangecolor(a),""==r||"undefined"==typeof r)i.setAttributeValue(null,"color",a,"fragement",null);else{i.setAttributeValue(r,"color",a,"association",null);var e=$("#"+r).children("li").children(".task_color").css("background-color"),t=i.colorTranslate(e);$("#"+r).children("li").children(".task_color").removeClass(t),$("#"+r).children("li").children(".task_color").addClass(s)}}),$("body").delegate("#arrow","click",function(){var e=$("#taskpanel"),t=e.position();t.left>=0?($("#taskpanel").animate({left:"-=250px"},"slow"),$("#paper").animate({left:"-=130px"},"slow"),$("#arrow").animate({left:"-=250px"},"slow"),$("#arrow").css("background-image","url(image/navigation-right-frame.png)")):($("#taskpanel").animate({left:"+=250px"},"slow"),$("#paper").animate({left:"+=130px"},"slow"),$("#arrow").animate({left:"+=250px"},"slow"),$("#arrow").css("background-image","url(image/navigation-left-frame.png)"))}),$("body").delegate(".triangle","click",function(e){e.stopPropagation(),r=$(this).parent("li").parent("ol").attr("id"),$(this).parent("li").siblings(".sublist").is(":hidden")?($("#"+r).children("li").children(".triangle").removeClass("triangle-right"),$("#"+r).children("li").children(".triangle").addClass("triangle-down"),$("#"+r).children("ol").slideDown("slow")):($("#"+r).children("li").children(".triangle").removeClass("triangle-down"),$("#"+r).children("li").children(".triangle").addClass("triangle-right"),$("#"+r).children("ol").slideUp("slow"))})}var i=new e;$(window).load(function(){t()}),$(document).ready(function(){n()})}.call(this);